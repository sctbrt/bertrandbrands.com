---
/**
 * Website Conversion Snapshot Intake — Single-page form with order summary.
 * Centered logo-only header (no back button). Amber accents.
 * Submits to Formspree + /api/notify + Zapier.
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import SkipLink from '../../components/SkipLink.astro';
import VisitorNotify from '../../components/VisitorNotify.astro';
import GesturePrevention from '../../components/GesturePrevention.astro';

const currentYear = new Date().getFullYear();
---

<BaseLayout
    title="Website Conversion Snapshot Intake — BG | Brand & Web Systems"
    description="Complete this form to start your Website Conversion Snapshot."
    canonical="https://bertrandbrands.ca/intake/website-conversion-snapshot"
    robots="noindex, nofollow"
>
    <Fragment slot="head">
        <style is:inline>
            html { touch-action: pan-x pan-y; }
            @supports (-webkit-touch-callout: none) { html { -webkit-text-size-adjust: 100%; } }

            .intake-page {
                min-height: 100vh;
                padding-top: 80px;
                position: relative;
                overflow: hidden;
            }

            .intake-header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                padding: var(--space-sm) var(--gutter, 1.5rem);
                background: rgba(10, 10, 10, 0.9);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                border-bottom: 1px solid var(--border);
            }

            .intake-header__inner {
                max-width: var(--container-max);
                margin: 0 auto;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .intake-header__logo {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                text-decoration: none;
                color: var(--text);
            }

            .intake-header__logo-icon {
                width: 24px;
                height: auto;
                filter: brightness(0) invert(1);
            }

            .intake-header__logo-text {
                font-family: 'Inter', -apple-system, sans-serif;
                font-size: var(--text-sm);
                font-weight: 500;
                letter-spacing: 0.05em;
                text-transform: uppercase;
                color: var(--text);
            }

            .intake-content {
                max-width: 560px;
                margin: 0 auto;
                padding: var(--space-2xl) var(--gutter, 1.5rem);
            }

            .intake-title {
                font-family: 'Inter', -apple-system, sans-serif;
                font-size: clamp(1.75rem, 4vw, 2.25rem);
                font-weight: 300;
                line-height: 1.2;
                margin-bottom: var(--space-sm);
                color: var(--text);
                text-align: center;
            }

            .intake-summary {
                background: var(--bg-alt, #0d0d0d);
                border: 1px solid var(--border);
                border-radius: var(--radius-lg);
                padding: var(--space-md);
                margin-bottom: var(--space-xl);
            }

            .intake-summary__row {
                display: flex;
                justify-content: space-between;
                align-items: baseline;
                padding: 0.5rem 0;
                border-bottom: 1px solid var(--border);
            }

            .intake-summary__row:last-child {
                border-bottom: none;
            }

            .intake-summary__label {
                font-size: var(--text-sm);
                color: var(--text-muted);
            }

            .intake-summary__value {
                font-size: var(--text-sm);
                color: var(--text);
                font-weight: 500;
            }

            .intake-summary__value--price {
                color: var(--accent);
                font-size: var(--text-base);
            }

            .intake-form {
                display: flex;
                flex-direction: column;
                gap: var(--space-md);
            }

            .intake-form__group {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .intake-form__label {
                font-size: var(--text-sm);
                font-weight: 500;
                color: var(--text);
            }

            .intake-form__label span {
                font-weight: 400;
                color: var(--text-subtle);
            }

            .intake-form__input,
            .intake-form__textarea {
                background: var(--bg-alt, #0d0d0d);
                border: 1px solid var(--border);
                border-radius: var(--radius-md);
                padding: 0.875rem 1rem;
                font-size: var(--text-base);
                color: var(--text);
                font-family: inherit;
                transition: border-color var(--duration-fast) var(--ease-out);
            }

            .intake-form__input:focus,
            .intake-form__textarea:focus {
                outline: none;
                border-color: var(--accent);
            }

            .intake-form__input::placeholder,
            .intake-form__textarea::placeholder {
                color: var(--text-subtle);
            }

            .intake-form__textarea {
                min-height: 120px;
                resize: vertical;
            }

            .intake-form__help {
                font-size: var(--text-xs);
                color: var(--text-subtle);
                line-height: 1.5;
            }

            .intake-form__submit {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                padding: 1rem 2rem;
                margin-top: var(--space-sm);
                background: rgba(217, 119, 6, 0.85);
                border: 1px solid rgba(217, 119, 6, 0.3);
                color: #000;
                font-size: var(--text-base);
                font-weight: 500;
                border-radius: var(--radius-md);
                cursor: pointer;
                transition: background var(--duration-fast) var(--ease-out);
            }

            .intake-form__submit:hover {
                background: rgba(217, 119, 6, 0.95);
            }

            .intake-form__submit:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            .intake-form__note {
                font-size: var(--text-xs);
                color: var(--text-subtle);
                text-align: center;
                line-height: 1.6;
            }

            .intake-success {
                text-align: center;
                padding: var(--space-2xl) 0;
                display: none;
            }

            .intake-success.active {
                display: block;
            }

            .intake-form.hidden {
                display: none;
            }

            .intake-success__icon {
                width: 64px;
                height: 64px;
                margin: 0 auto var(--space-md);
                background: rgba(217, 119, 6, 0.15);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .intake-success__icon svg {
                width: 32px;
                height: 32px;
                color: var(--accent);
            }

            .intake-success__title {
                font-family: 'Inter', -apple-system, sans-serif;
                font-size: var(--text-xl);
                font-weight: 400;
                margin-bottom: var(--space-sm);
                color: var(--text);
            }

            .intake-success__text {
                font-size: var(--text-sm);
                color: var(--text-muted);
                line-height: 1.7;
                max-width: 400px;
                margin: 0 auto;
            }

            .intake-footer {
                border-top: 1px solid var(--border);
                padding: var(--space-xl) var(--gutter, 1.5rem);
                text-align: center;
                margin-top: var(--space-2xl);
            }

            .intake-footer__text {
                font-size: var(--text-sm);
                color: var(--text-subtle);
            }

            .intake-spotlight {
                position: fixed;
                border-radius: 50%;
                filter: blur(120px);
                pointer-events: none;
                z-index: 0;
                opacity: 0.6;
            }

            .intake-spotlight--orange {
                width: 300px;
                height: 300px;
                background: radial-gradient(circle, rgba(217, 119, 6, 0.15) 0%, transparent 70%);
                bottom: -100px;
                left: -100px;
            }

            .intake-spotlight--blue {
                width: 250px;
                height: 250px;
                background: radial-gradient(circle, rgba(37, 99, 235, 0.1) 0%, transparent 70%);
                top: 80px;
                right: -80px;
            }

            @media (max-width: 768px) {
                .intake-spotlight {
                    filter: blur(80px);
                }
                .intake-spotlight--orange {
                    width: 200px;
                    height: 200px;
                }
                .intake-spotlight--blue {
                    width: 180px;
                    height: 180px;
                }
            }
        </style>
    </Fragment>

    <SkipLink />

    <!-- Ambient Spotlights -->
    <div class="intake-spotlight intake-spotlight--orange" aria-hidden="true"></div>
    <div class="intake-spotlight intake-spotlight--blue" aria-hidden="true"></div>

    <!-- Centered Logo Header -->
    <header class="intake-header">
        <div class="intake-header__inner">
            <span class="intake-header__logo">
                <img src="/assets/bg-brands-logomark.png" alt="" class="intake-header__logo-icon" width="40" height="40" fetchpriority="high">
                <span class="intake-header__logo-text">Bertrand Group</span>
            </span>
        </div>
    </header>

    <main class="intake-page" id="main-content">
        <div class="intake-content">
            <h1 class="intake-title">Website Conversion Snapshot</h1>

            <!-- Order Summary -->
            <div class="intake-summary">
                <div class="intake-summary__row">
                    <span class="intake-summary__label">Service</span>
                    <span class="intake-summary__value">Website Conversion Snapshot</span>
                </div>
                <div class="intake-summary__row">
                    <span class="intake-summary__label">Deliverable</span>
                    <span class="intake-summary__value">PDF with Top 5 Fixes</span>
                </div>
                <div class="intake-summary__row">
                    <span class="intake-summary__label">Turnaround</span>
                    <span class="intake-summary__value">48 Hours</span>
                </div>
                <div class="intake-summary__row">
                    <span class="intake-summary__label">Price</span>
                    <span class="intake-summary__value intake-summary__value--price">$195 CAD</span>
                </div>
            </div>

            <!-- Intake Form -->
            <form class="intake-form" id="intakeForm" action="https://formspree.io/f/xnjjgoay" method="POST">
                <input type="hidden" name="source" value="website_conversion_snapshot">
                <input type="hidden" name="service" value="Website Conversion Snapshot">
                <input type="hidden" name="price" value="$195 CAD">
                <input type="hidden" name="_subject" value="New Intake — Website Conversion Snapshot ($195)">
                <input type="text" name="_gotcha" class="form-honeypot" tabindex="-1" autocomplete="off">

                <div class="intake-form__group">
                    <label class="intake-form__label" for="name">Name</label>
                    <input type="text" id="name" name="name" class="intake-form__input" placeholder="Your name" required>
                </div>

                <div class="intake-form__group">
                    <label class="intake-form__label" for="email">Email</label>
                    <input type="email" id="email" name="email" class="intake-form__input" placeholder="you@example.com" required>
                </div>

                <div class="intake-form__group">
                    <label class="intake-form__label" for="business">Business Name <span>(optional)</span></label>
                    <input type="text" id="business" name="business" class="intake-form__input" placeholder="Your business name">
                </div>

                <div class="intake-form__group">
                    <label class="intake-form__label" for="website">Website URL</label>
                    <input type="url" id="website" name="website" class="intake-form__input" placeholder="https://yourwebsite.com" required>
                    <p class="intake-form__help">The website you'd like reviewed</p>
                </div>

                <div class="intake-form__group">
                    <label class="intake-form__label" for="concerns">What feels broken right now? <span>(optional)</span></label>
                    <textarea id="concerns" name="concerns" class="intake-form__textarea" placeholder="Are there specific pages or issues you'd like us to focus on?"></textarea>
                </div>

                <button type="submit" class="intake-form__submit" id="submitBtn">Submit Request</button>

                <p class="intake-form__note">
                    After submitting, you'll receive an email with payment instructions. Your snapshot begins once payment is received—delivered within 48 hours.
                </p>
            </form>

            <!-- Success State -->
            <div class="intake-success" id="successState">
                <div class="intake-success__icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <h2 class="intake-success__title">Request Received</h2>
                <p class="intake-success__text">
                    Thank you. You'll receive an email shortly with payment details. Once payment is confirmed, your Website Conversion Snapshot will be delivered within 48 hours.
                </p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="intake-footer">
        <p class="intake-footer__text">&copy; {currentYear} Bertrand Group. All rights reserved.</p>
        <p class="footer-division"><a href="https://bertrandgroup.ca">A division of Bertrand Group Canada</a></p>
    </footer>

    <script is:inline>
        var form = document.getElementById('intakeForm');
        var submitBtn = document.getElementById('submitBtn');
        var successState = document.getElementById('successState');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            var formData = new FormData(form);

            try {
                var response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    form.classList.add('hidden');
                    successState.classList.add('active');

                    var payload = {
                        type: 'intake',
                        source: 'website_conversion_snapshot',
                        service: 'Website Conversion Snapshot',
                        price: '$195 CAD',
                        name: formData.get('name'),
                        email: formData.get('email'),
                        business: formData.get('business') || '',
                        website: formData.get('website'),
                        concerns: formData.get('concerns') || ''
                    };

                    fetch('/api/notify', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }).catch(function() {});

                    fetch('https://hooks.zapier.com/hooks/catch/26192099/uqqr4uk/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }).catch(function() {});
                } else {
                    throw new Error('Form submission failed');
                }
            } catch (error) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Request';
                alert('Something went wrong. Please try again or email hello@bertrandgroup.ca');
            }
        });

    </script>

    <GesturePrevention />
    <VisitorNotify />
</BaseLayout>
