---
/**
 * HeaderUniversal — Standard header for sub-pages.
 * Uses /?skip#section links to navigate to homepage sections.
 * Includes mobile menu, ambient lighting (lights-on immediately),
 * and animated wordmark: BERTRAND BRANDS → BERTRAND BRAND & WEB SYSTEMS.
 * Pages using this header need the landing-page header visibility override CSS.
 */
---

<header class="header">
    <div class="header__glass">
        <div class="header__inner">
            <a href="/?skip" class="header__logo">
                <img src="/assets/bg-brands-logomark.png" alt="" class="header__logo-icon" width="40" height="40" fetchpriority="high">
                <span class="header__wordmark" aria-label="Bertrand Brands — Brand &amp; Web Systems">
                    <span class="header__wordmark-short" aria-hidden="true">BERTRAND BRANDS</span>
                    <span class="header__wordmark-full" aria-hidden="true">BERTRAND BRANDS <span class="header__wordmark-sep">|</span> <span class="header__wordmark-sub">Brand &amp; Web Systems</span></span>
                </span>
            </a>
            <button class="header__toggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="mainNav">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="header__nav" id="mainNav">
                <a href="/?skip#about" class="header__link">About</a>
                <a href="/?skip#process" class="header__link">How It Works</a>
                <a href="/?skip#services" class="header__link">Services</a>
                <a href="/book" class="header__link header__link--cta">Book a Call</a>
                <span class="header__divider" aria-hidden="true"></span>
                <a href="https://clients.bertrandgroup.ca" class="header__link header__link--portal">Client Portal</a>
            </nav>
        </div>
    </div>
</header>

<script is:inline>
/* Mobile menu + ambient lighting + smooth wordmark crossfade (sub-pages) */
(function() {
    /* Mobile menu */
    var toggle = document.querySelector('.header__toggle');
    var nav = document.querySelector('.header__nav');
    var header = document.querySelector('.header');
    if (!toggle || !nav) return;

    toggle.addEventListener('click', function() {
        var isOpen = nav.classList.toggle('is-open');
        toggle.classList.toggle('is-open', isOpen);
        toggle.setAttribute('aria-expanded', isOpen);
        if (header) header.classList.toggle('nav-open', isOpen);
        document.body.style.overflow = isOpen ? 'hidden' : '';
    });

    nav.querySelectorAll('a').forEach(function(link) {
        link.addEventListener('click', function() {
            nav.classList.remove('is-open');
            toggle.classList.remove('is-open');
            toggle.setAttribute('aria-expanded', 'false');
            if (header) header.classList.remove('nav-open');
            document.body.style.overflow = '';
        });
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && nav.classList.contains('is-open')) {
            nav.classList.remove('is-open');
            toggle.classList.remove('is-open');
            toggle.setAttribute('aria-expanded', 'false');
            if (header) header.classList.remove('nav-open');
            document.body.style.overflow = '';
            toggle.focus();
        }
    });

    /* Ambient lighting (30fps throttled) */
    var reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!reducedMotion) {
        var headerGlass = document.querySelector('.header__glass');
        if (header && headerGlass) {
            header.classList.add('lights-on');

            var pos1 = 15, pos2 = 85, dir1 = 1, dir2 = -1;
            var lastFrame = 0;
            var FRAME_INTERVAL = 1000 / 30;

            function animateLights(timestamp) {
                if (timestamp - lastFrame < FRAME_INTERVAL) {
                    requestAnimationFrame(animateLights);
                    return;
                }
                lastFrame = timestamp;
                pos1 += dir1 * 0.06;
                pos2 += dir2 * 0.05;
                if (pos1 > 35 || pos1 < 10) dir1 *= -1;
                if (pos2 > 90 || pos2 < 60) dir2 *= -1;
                headerGlass.style.setProperty('--orange-pos-1', pos1 + '%');
                headerGlass.style.setProperty('--orange-pos-2', pos2 + '%');
                requestAnimationFrame(animateLights);
            }
            requestAnimationFrame(animateLights);
        }
    }

    /* ============================================================
       Smooth Wordmark Crossfade
       BERTRAND BRANDS ←→ BERTRAND BRANDS | Brand & Web Systems
       ============================================================ */
    var wmWrap = document.querySelector('.header__wordmark');
    if (!wmWrap) return;

    var collapseTimer = null;
    var expandTimer = null;

    function expand() {
        wmWrap.classList.add('is-expanded');
    }

    function collapse() {
        wmWrap.classList.remove('is-expanded');
    }

    if (reducedMotion) {
        wmWrap.style.opacity = '1';
        return;
    }

    wmWrap.style.opacity = '1';

    /* Auto-expand after 4 seconds, collapse back after 8 */
    expandTimer = setTimeout(function() {
        expand();
        collapseTimer = setTimeout(function() {
            collapse();
        }, 8000);
    }, 4000);

    /* Hover: expand on enter, collapse on leave (desktop only) */
    var logoLink = document.querySelector('.header__logo');
    if (logoLink && window.matchMedia('(hover: hover) and (min-width: 769px)').matches) {
        logoLink.addEventListener('mouseenter', function() {
            clearTimeout(expandTimer);
            clearTimeout(collapseTimer);
            expand();
        });
        logoLink.addEventListener('mouseleave', function() {
            clearTimeout(collapseTimer);
            collapseTimer = setTimeout(function() {
                collapse();
            }, 1500);
        });
    }
})();
</script>
