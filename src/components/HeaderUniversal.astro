---
/**
 * HeaderUniversal â€” Standard header for sub-pages.
 * Uses /?skip#section links to navigate to homepage sections.
 * Includes mobile menu, ambient lighting (lights-on immediately), and wordmark collapse.
 * Pages using this header need the landing-page header visibility override CSS.
 */
---

<header class="header">
    <div class="header__glass">
        <div class="header__inner">
            <a href="/?skip" class="header__logo">
                <img src="/assets/bg-brands-logomark.png" alt="" class="header__logo-icon" width="40" height="40" fetchpriority="high">
                <span class="header__wordmark" aria-label="Bertrand Group | Brand &amp; Web Systems">
                    <span class="header__wordmark-full"><span class="header__wordmark-brand">Bertrand Group</span> <span class="header__wordmark-sub">| Brand &amp; Web Systems</span></span>
                    <span class="header__wordmark-short"><span class="header__wordmark-sub">Brand &amp; Web Systems</span></span>
                </span>
            </a>
            <button class="header__toggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="mainNav">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="header__nav" id="mainNav">
                <a href="/?skip#about" class="header__link">About</a>
                <a href="/?skip#process" class="header__link">How It Works</a>
                <a href="/?skip#services" class="header__link">Services</a>
                <a href="/book" class="header__link header__link--cta">Book a Call</a>
                <span class="header__divider" aria-hidden="true"></span>
                <a href="https://clients.bertrandgroup.ca" class="header__link header__link--portal">Client Portal</a>
            </nav>
        </div>
    </div>
</header>

<script is:inline>
/* Mobile menu + ambient lighting + wordmark collapse (sub-pages) */
(function() {
    /* Mobile menu */
    const toggle = document.querySelector('.header__toggle');
    const nav = document.querySelector('.header__nav');
    const header = document.querySelector('.header');
    if (!toggle || !nav) return;

    toggle.addEventListener('click', function() {
        const isOpen = nav.classList.toggle('is-open');
        toggle.classList.toggle('is-open', isOpen);
        toggle.setAttribute('aria-expanded', isOpen);
        if (header) header.classList.toggle('nav-open', isOpen);
        document.body.style.overflow = isOpen ? 'hidden' : '';
    });

    nav.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            nav.classList.remove('is-open');
            toggle.classList.remove('is-open');
            toggle.setAttribute('aria-expanded', 'false');
            if (header) header.classList.remove('nav-open');
            document.body.style.overflow = '';
        });
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && nav.classList.contains('is-open')) {
            nav.classList.remove('is-open');
            toggle.classList.remove('is-open');
            toggle.setAttribute('aria-expanded', 'false');
            if (header) header.classList.remove('nav-open');
            document.body.style.overflow = '';
            toggle.focus();
        }
    });

    /* Ambient lighting (30fps throttled) */
    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        const headerGlass = document.querySelector('.header__glass');
        if (header && headerGlass) {
            header.classList.add('lights-on');

            let pos1 = 15, pos2 = 85, dir1 = 1, dir2 = -1;
            let lastFrame = 0;
            const FRAME_INTERVAL = 1000 / 30;

            function animateLights(timestamp) {
                if (timestamp - lastFrame < FRAME_INTERVAL) {
                    requestAnimationFrame(animateLights);
                    return;
                }
                lastFrame = timestamp;
                pos1 += dir1 * 0.06;
                pos2 += dir2 * 0.05;
                if (pos1 > 35 || pos1 < 10) dir1 *= -1;
                if (pos2 > 90 || pos2 < 60) dir2 *= -1;
                headerGlass.style.setProperty('--orange-pos-1', pos1 + '%');
                headerGlass.style.setProperty('--orange-pos-2', pos2 + '%');
                requestAnimationFrame(animateLights);
            }
            requestAnimationFrame(animateLights);
        }
    }

    /* Wordmark collapse (desktop only, respects reduced-motion) */
    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches &&
        !window.matchMedia('(max-width: 768px)').matches) {
        const wordmark = document.querySelector('.header__wordmark');
        if (wordmark) {
            setTimeout(function() {
                wordmark.classList.add('is-collapsed');
            }, 2000);
        }
    }
})();
</script>
